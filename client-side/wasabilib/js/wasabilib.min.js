function DataExtractor(){this.element=null}function Callback(a,b){var c=this;c.key=a,c.dataExtractor=b,c.condition=new Condition(function(){return!0})}function Condition(a){var b=this;b.handle=a,b.timeOut=0,b.actualTimerId=null}function ResponseHandler(){this.execRPCManager=null}function Wasabi(){var a=this;a.notificationCenter=new NotificationCenter(a),a.executeRemoteProcedureCallManager=null,a.registeredElements={},a.possibleEvents=null,a.possibleCallbacks={},a.registerCommonEvents()}function NotificationCenter(a){var b=this;b.wasabi=a,b.observers=[]}function ExecuteRemoteProcedureCallManager(){var a=this;a.possibleMethods=void 0,a.keywords={location:$(location)}}function Alert(){ResponseHandler.call(this),this.ACTION_TYPE_JS_ALERT="alert"}function ConsoleLog(){ResponseHandler.call(this)}function InnerHtml(){ResponseHandler.call(this);var a=this;a.ACTION_TYPE_REPLACE="html",a.ACTION_TYPE_APPEND="appendTo",a.ACTION_TYPE_REMOVE="empty"}function DomManipulator(){ResponseHandler.call(this)}function TriggerEventManager(){ResponseHandler.call(this),this.possibleEvents={ACTION_TYPE_TRIGGER_EVENT_NEXT_STEP:"nextStep",ACTION_TYPE_TRIGGER_EVENT_PREVIOUS_STEP:"prevStep",ACTION_TYPE_TRIGGER_EVENT_CLICK:"click",ACTION_TYPE_TRIGGER_EVENT_FOCUS:"focus"}}function Form(){DataExtractor.call(this)}function External_Form(){Form.call(this)}function Text_Field(){DataExtractor.call(this)}DataExtractor.prototype.setTarget=function(a){this.element="object"==typeof a?a.closest(".wasabi-ajax-element"):$("#"+a.closest(".wasabi-ajax-element"))},DataExtractor.prototype.getTransmissionCapableContent=function(){var a=this;return a.element.attr("data-json")?JSON.parse(a.element.attr("data-json")):null},DataExtractor.prototype.getUri=function(){var a=this;return a.element.attr("href")?a.element.attr("href"):a.element.attr("data-href")?a.element.attr("data-href"):null},DataExtractor.prototype.getElement=function(){return this.element},Callback.prototype.getKey=function(){return this.key},Callback.prototype.execute=function(a){this.dataExtractor.setTarget($(a.target))},Callback.prototype.setCondition=function(a){this.condition=a},Callback.prototype.getCondition=function(){return this.condition},Condition.prototype.check=function(a){return this.handle(a)},Condition.prototype.checkTimeOut=function(a){var b=this;b.actualTimerId&&clearTimeout(b.actualTimerId),b.actualTimerId=setTimeout(function(){a(),b.actualTimerId=null},b.getTimeout())},Condition.prototype.setTimeout=function(a){this.timeOut=a},Condition.prototype.getTimeout=function(){return this.timeOut},ResponseHandler.prototype.setExecuteRemoteProcedureCallManager=function(a){this.execRPCManager=a},ResponseHandler.prototype.update=function(a){var b=this,c=a.message;b.execRPCManager.execute(c.selector,c.actionType,c.params)},Wasabi.prototype.getNotificationCenter=function(){return this.notificationCenter},Wasabi.prototype.addPossibleEvent=function(a){this.possibleEvents[a]=!0},Wasabi.prototype.setNotificationCenter=function(a){this.notificationCenter=a},Wasabi.prototype.setExecuteRemoteProcedureCallManager=function(a){this.executeRemoteProcedureCallManager=a},Wasabi.prototype.getExecuteRemoteProcedureCallManager=function(){return this.executeRemoteProcedureCallManager},Wasabi.prototype.addCallback=function(a){var b=this;b.possibleCallbacks[a.getKey()]=a,b.registerEventHandler()},Wasabi.prototype.registerCommonEvents=function(){var a=this;$(document).on("wasabiNotification",null,function(b){a.getNotificationCenter().notify(b.message)}),$(document).on("wasabi_new_wasabi-ajax-element",null,function(b){a.registerEventHandler()})},Wasabi.prototype.registerEventHandler=function(){var a=this;$(".wasabi-ajax-element").each(function(b){var c=$(this),d=c.attr("data-event"),e=c.attr("id"),f=a.getCallback(c.attr("data-cb"));if(!a.registeredElements[e]&&(void 0==c.attr("data-cb")||void 0!=f)&&("FORM"===c.prop("tagName")?(d=d||"submit",f=f||a.getCallback("form")):"A"===c.prop("tagName")?(f=f||a.getCallback("link"),d=d||"click"):c.hasClass("wasabi_suggest")?(f=f||a.getCallback("suggest"),d=d||"keyup"):(f=f||a.getCallback("button"),d=d||"click"),d&&f)){if(a.possibleEvents[d]){if(!$(this).attr("id"))throw new Error(c.tagName+"needs an id attribute.");$(document).on(d,"#"+e,function(b){b.preventDefault(),f.execute(b);var c={};if("FORM"===f.dataExtractor.getElement().prop("tagName")&&"get"!=f.dataExtractor.getElement().attr("method")&&(c.type="POST"),f.getCondition().check(b)){var d=f.dataExtractor.getElement().attr("data-timeout");void 0!=d&&f.getCondition().setTimeout(d);var e=f.dataExtractor.getElement().attr("data-disabletime");if(e&&("A"===f.dataExtractor.getElement().prop("tagName")&&f.dataExtractor.getElement().attr("data-href",f.dataExtractor.getElement().attr("href")).removeAttr("href"),"FORM"===f.dataExtractor.getElement().prop("tagName")?f.dataExtractor.getElement().find("[type=submit]").prop("disabled",!0):f.dataExtractor.getElement().prop("disabled",!0),"true"!==e&&$.isNumeric(e))){var g=new Condition;g.setTimeout(e),g.checkTimeOut(function(){"A"===f.dataExtractor.getElement().prop("tagName")&&f.dataExtractor.getElement().attr("href",f.dataExtractor.getElement().attr("data-href")).removeAttr("data-href"),"FORM"===f.dataExtractor.getElement().prop("tagName")?f.dataExtractor.getElement().find("[type=submit]").prop("disabled",!1):f.dataExtractor.getElement().prop("disabled",!1)})}f.getCondition().checkTimeOut(function(){a.send(f.dataExtractor.getUri(),f.dataExtractor,c)})}})}else;a.registeredElements[e]=!0}})},Wasabi.prototype.getCallback=function(a){var b=this;if(!a||b.possibleCallbacks[a])return a?b.possibleCallbacks[a]:null},Wasabi.prototype.setPossibleEvents=function(a){this.possibleEvents=a},Wasabi.prototype.addPossibleEvent=function(a){this.possibleEvents[a]=!0},Wasabi.prototype.send=function(a,b,c){var d=this,e="GET",f=b.getElement();c&&!!c.type&&(e=c.type);var g=b?b.getTransmissionCapableContent():{},h=f.attr("data-json")?JSON.parse(f.attr("data-json")):{},i=g;h&&($.isArray(g)?$.each(h,function(a,b){g.push({name:a,value:b})}):$.extend(i,g,h)),i=$.extend(i,{triggeredId:f.attr("id")}),d.ajax({type:e,url:a,data:i,loaderId:f.attr("data-ajax-loader")},function(a){a&&console.log(a.message),void 0!=f.attr("data-disabletime")&&"true"==f.attr("data-disabletime")&&("A"===f.prop("tagName")&&f.attr("href",f.attr("data-href")).removeAttr("data-href"),"FORM"===f.prop("tagName")?f.find("[type=submit]").prop("disabled",!1):f.prop("disabled",!1))})},Wasabi.prototype.ajax=function(a,b){var c=this,d=a.type?a.type:"GET",e=a.url,f=a.data,g="json",h=a.loaderId?$("#"+a.loaderId):null,i=null,k=(a.selector&&$(a.selector),{type:d,url:e,data:f,dataType:g,beforeSend:function(a){h&&h.show()},error:function(a){if(console.log("The server response is not a wasabilib response."),a.responseText){if(i=new Error("See response for details: "+a.responseText),b)return b(i);console.log(i)}}});a.contentType&&(k.contentType=a.contentType),$.ajax(k).done(function(a){if(!a[0].status){if(i=new Error("The server response is not a wasabilib response."),b)return b(i);console.log(i)}if(i||(c.getNotificationCenter().notify(a),c.registerEventHandler()),h&&h.hide(),b)return b(i,a)})},NotificationCenter.prototype.register=function(a){var b=this;a.setExecuteRemoteProcedureCallManager(b.wasabi.getExecuteRemoteProcedureCallManager()),b.observers.push(a)},NotificationCenter.prototype.remove=function(a,b){var c=this;delete c.observers[c.generateIndex(a,b)]},NotificationCenter.prototype.generateIndex=function(a,b){return a+"+"+b},NotificationCenter.prototype.notify=function(a){var b=this;jQuery.each(b.observers,function(b){var b=this;jQuery.each(a,function(a,c){void 0!=window[c.responseHandler]&&b instanceof window[c.responseHandler]&&b.update(c)})})},ExecuteRemoteProcedureCallManager.prototype.execute=function(a,b,c){var d=this;d.possibleMethods[b]?d.keywords[a]?d.keywords[a][d.possibleMethods[b]].apply(d.keywords[a],c):void 0==a?window[d.possibleMethods[b]].apply(window,c):$(a)[d.possibleMethods[b]].apply($(a),c):console.log("The given method "+b+" is not a valid method name")},ExecuteRemoteProcedureCallManager.prototype.setPossibleMethods=function(a){this.possibleMethods=a},Alert.prototype=Object.create(ResponseHandler.prototype),Alert.prototype.update=function(a){var b=this,c=a.message;b.execRPCManager.execute(void 0,c.actionType,c.params)},ConsoleLog.prototype=Object.create(ResponseHandler.prototype),ConsoleLog.prototype.update=function(a){console.log(a.message)},InnerHtml.prototype=Object.create(ResponseHandler.prototype),DomManipulator.prototype=Object.create(ResponseHandler.prototype),TriggerEventManager.prototype=Object.create(ResponseHandler.prototype),TriggerEventManager.prototype.update=function(a){var b=this,c=a.message;b.possibleEvents[c.params[0]]?b.execRPCManager.execute(c.selector,c.actionType,[b.possibleEvents[c.params[0]]]):console.log("The given event "+c.params[0]+" is not a valid event name")},Form.prototype=Object.create(DataExtractor.prototype),Form.prototype.setTarget=function(a){this.element="object"==typeof a?a:$("#"+a)},Form.prototype.getTransmissionCapableContent=function(){return this.getElement().serializeArray()},Form.prototype.getUri=function(){return this.getElement().attr("action")},External_Form.prototype=Object.create(Form.prototype),External_Form.prototype.setTarget=function(a){var b=this;b.element="FORM"===a.tagName?a:$("#"+a.attr("form")),b.jsonParams=$(a).attr("data-json")?JSON.parse("["+$(a).attr("data-json")+"]"):null},External_Form.prototype.getTransmissionCapableContent=function(){var a=this,b=Form.prototype.getTransmissionCapableContent.call(this);return a.jsonParams&&$.merge(b,a.jsonParams),b},Text_Field.prototype=Object.create(DataExtractor.prototype),Text_Field.prototype.getTransmissionCapableContent=function(){return{content:this.getElement().val()}},$(document).ready(function(){wasabi=new Wasabi,$.Wasabi=wasabi,wasabi.setPossibleEvents({select:!0,search:!0,dblclick:!0,mouseover:!0,mouseout:!0,click:!0,mousedown:!0,submit:!0,blur:!0,keyup:!0,keydown:!0,keypress:!0}),wasabi.setExecuteRemoteProcedureCallManager(new ExecuteRemoteProcedureCallManager),wasabi.getNotificationCenter().register(new Alert),wasabi.getNotificationCenter().register(new InnerHtml),wasabi.getNotificationCenter().register(new DomManipulator),wasabi.getNotificationCenter().register(new ConsoleLog),wasabi.getNotificationCenter().register(new TriggerEventManager),wasabi.addCallback(new Callback("link",new DataExtractor)),wasabi.addCallback(new Callback("button",new DataExtractor)),wasabi.addCallback(new Callback("ext_form_submit",new External_Form)),wasabi.addCallback(new Callback("form",new Form)),wasabi.addCallback(new Callback("text",new Text_Field)),wasabi.getExecuteRemoteProcedureCallManager().setPossibleMethods({ACTION_TYPE_SHOW:"show",ACTION_TYPE_HIDE:"hide",ACTION_TYPE_MODAL:"modal",ACTION_TYPE_SLIDEDOWN:"slideDown",ACTION_TYPE_SLIDEUP:"slideUp",ACTION_TYPE_REPLACE:"html",ACTION_TYPE_APPEND:"append",ACTION_TYPE_REMOVE:"empty",ACTION_TYPE_CSS:"css",ACTION_TYPE_FADEOUT:"fadeOut",ACTION_TYPE_FADEIN:"fadeIn",ACTION_TYPE_ATTR:"attr",ACTION_TYPE_ADD_CLASS:"addClass",ACTION_TYPE_REMOVE_CLASS:"removeClass",ACTION_TYPE_TOGGLE_CLASS:"toggleClass",ACTION_TYPE_HREF:"href",ACTION_TYPE_DROPZONE_DISCOVER:"discover",ACTION_TYPE_TRIGGER:"trigger",ACTION_TYPE_REMOVE_ELEMENT:"remove",ACTION_TYPE_JS_ALERT:"alert"})});